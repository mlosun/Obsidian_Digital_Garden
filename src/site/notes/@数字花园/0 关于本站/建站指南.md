---
{"dg-publish":true,"dg-path":"0 å…³äºæœ¬ç«™/å»ºç«™æŒ‡å—.md","permalink":"/0 å…³äºæœ¬ç«™/å»ºç«™æŒ‡å—/","pinned":true,"created":"2025-08-01","updated":"2025-08-04"}
---


æˆ‘ä½¿ç”¨ã€ŒObsidian + Digital Garden + Github + Cloudflareã€æ–¹æ¡ˆå»ºè®¾æœ¬ç«™ã€‚

## ä¸€ã€åŸºç¡€æ­å»º

### åˆ›å»º Github ä»“åº“å’Œä»¤ç‰Œ

1. åˆ›å»ºä»“åº“ï¼šæ‰“å¼€è¿™ä¸ª [ä»“åº“](https://github.com/oleeskild/digitalgarden)ï¼Œç‚¹å‡» `Use this template`ï¼Œæ–°å»ºä¸€ä¸ª Github ä»“åº“
2. åˆ›å»ºä»¤ç‰Œï¼šæ‰“å¼€è¿™ä¸ª [é¡µé¢](https://github.com/settings/personal-access-tokens/new)ï¼Œé€‰æ‹©æœ‰æ•ˆæœŸå’Œåˆšåˆšåˆ›å»ºçš„ä»“åº“ï¼Œæƒé™åˆ—è¡¨ä¸­é€‰æ‹© `Contents` å’Œ `Pull requests`ï¼ˆæ³¨æ„ä¿å­˜ä»¤ç‰Œï¼Œåªæ˜¾ç¤ºä¸€æ¬¡ï¼‰

### ä½¿ç”¨ Digital Garden æ’ä»¶

1. å®‰è£…æ’ä»¶ï¼šåœ¨ Obsidian ä¸­å®‰è£… [Digital Garden](obsidian://show-plugin?id=digitalgarden) æ’ä»¶å¹¶å¯ç”¨
2. é…ç½®æ’ä»¶ï¼š
	- GitHub repo nameï¼šå¡«å…¥åˆšåˆ›å»ºçš„ Github ä»“åº“åç§°
	- GitHub Usernameï¼šå¡«å…¥ä½ çš„ Github ç”¨æˆ·å
	- GitHub tokenï¼šå¡«å…¥åˆšåˆ›å»ºçš„ Github ä»¤ç‰Œ
	- ç­‰å¾…å‡ºç°â€œâœ…â€æ ‡å¿—
	- å…¶ä½™é…ç½®éƒ½æ˜¯å¯é€‰é¡¹ï¼Œå¯åç»­å‚è€ƒ [å®˜æ–¹æ–‡æ¡£](https://dg-docs.ole.dev/) é…ç½®

### éƒ¨ç½² Cloudflare Pages ç«™ç‚¹

1. æ‰“å¼€ [Cloudflare](https://www.cloudflare.com/zh-cn/)ï¼Œåœ¨â€œè®¡ç®— â†’ Workers å’Œ Pages â†’ Pagesâ€ä¸‹ï¼Œé€‰æ‹©â€œå¯¼å…¥ç°æœ‰ Git å­˜å‚¨åº“â€
2. é€‰æ‹©åˆšåˆšåˆ›å»ºçš„ Github ä»“åº“åå¼€å§‹é…ç½®ï¼š
	- æ„å»ºå‘½ä»¤ï¼šnpm run build
	- æ„å»ºè¾“å‡ºç›®å½•ï¼šdist
	- å…¶ä½™æœªæåˆ°çš„é»˜è®¤å³å¯
3. ç‚¹å‡»ä¿å­˜å¹¶éƒ¨ç½²ï¼Œç¨ç­‰ä¸€ä¼šï¼Œå°±å¯ä»¥åœ¨è¿™ä¸ª Pages é¡¹ç›®ä¸‹è·å–åˆ°é“¾æ¥å¹¶è®¿é—®ã€‚

> [!warning] æ³¨æ„
> Cloudflare å…è´¹è®¡åˆ’æ¯æœˆæœ€å¤šæ„å»ºéƒ¨ç½² 500 æ¬¡ï¼Œè€Œ Digital Garden æ˜¯åˆ©ç”¨çš„ Github APIï¼Œæ‰€æœ‰æ–‡ä»¶ä¿®æ”¹éƒ½æ˜¯ä¸€ä¸ªä¸ªæäº¤çš„ï¼Œå½“ä½ æœ‰å‡ åç¯‡ç¬”è®°æ—¶ï¼Œå¯èƒ½åœ¨è°ƒè¯•é˜¶æ®µå¾ˆå¿«å°±ä¼šè¾¾åˆ°ä¸Šé™ã€‚æ­¤é—®é¢˜å¯é€šè¿‡å®šæ—¶æ„å»ºéƒ¨ç½²è§£å†³ï¼Œå‚è§ï¼š[[@æ•°å­—èŠ±å›­/0 å…³äºæœ¬ç«™/å»ºç«™æŒ‡å—#é…ç½® Cloudflare Works å®šæ—¶å™¨ï¼ˆå¯é€‰ï¼‰\|é…ç½® Cloudflare Works å®šæ—¶å™¨ï¼ˆå¯é€‰ï¼‰]]

### é…ç½® Cloudflare Works å®šæ—¶å™¨ï¼ˆå¯é€‰ï¼‰

1. å–æ¶ˆè‡ªåŠ¨éƒ¨ç½²ï¼šæ‰“å¼€åˆšåˆšåœ¨ Cloudflare ä¸­åˆ›å»ºçš„ Pages é¡¹ç›®ï¼Œåœ¨è®¾ç½®ä¸­æ‰¾åˆ°â€œåˆ†æ”¯æ§åˆ¶â€ï¼š
	- å–æ¶ˆâ€œå¯ç”¨è‡ªåŠ¨ç”Ÿäº§åˆ†æ”¯éƒ¨ç½²â€å‹¾é€‰
	- é¢„è§ˆåˆ†æ”¯é€‰é¡¹æ”¹ä¸ºâ€œæ— â€
	- ä¿å­˜æäº¤
2. åˆ›å»ºéƒ¨ç½²æŒ‚é’©ï¼šåŒæ ·åœ¨ Pages é¡¹ç›®çš„è®¾ç½®ä¸­æ‰¾åˆ°â€œéƒ¨ç½²æŒ‚é’©â€ï¼Œåˆ›å»ºä¸€ä¸ªæŒ‚é’©åï¼Œä¼šè·å–åˆ°ä¸€ä¸ª Webhook
3. åˆ›å»º Works é¡¹ç›®ï¼šæ‰“å¼€ [Cloudflare](https://www.cloudflare.com/zh-cn/)ï¼Œåœ¨â€œè®¡ç®— â†’ Workers å’Œ Pages â†’ Workerâ€ä¸‹ï¼Œé€‰æ‹©â€œä» Hello World! å¼€å§‹â€ï¼Œåˆ›å»ºä¸€ä¸ª Works é¡¹ç›®
4. å®Œå–„ Works é¡¹ç›®ï¼šåˆ›å»º Works é¡¹ç›®æˆåŠŸåï¼Œç‚¹å‡»â€œç¼–è¾‘ä»£ç â€ï¼Œåœ¨æ‰“å¼€çš„ç¼–è¾‘å™¨ä¸­ç²˜è´´ä»¥ä¸‹ä»£ç ï¼ˆè®°å¾—æ›¿æ¢ KEY å’Œ Webhookï¼‰:

	```js
	/**
	 * Cloudflare Workerï¼šå®šæ—¶ + æ‰‹åŠ¨åŒè§¦å‘éƒ¨ç½²é’©å­
	 * åŠŸèƒ½ï¼š
	 *  1. é€šè¿‡ Cron Trigger å®šæ—¶è°ƒç”¨ Cloudflare Pages çš„ Deploy Hook
	 *  2. é€šè¿‡æµè§ˆå™¨æˆ– curl æ‰‹åŠ¨è§¦å‘ï¼ˆéœ€æºå¸¦å¯†é’¥å‚æ•° ?key=xxxï¼‰
	 */
	
	// 1) æ‰‹åŠ¨è§¦å‘æ‰€éœ€çš„å¯†é’¥ï¼Œè‡ªè¡Œæ›´æ¢æˆåªæœ‰è‡ªå·±çŸ¥é“çš„å­—ç¬¦ä¸²
	const SECRET_KEY = "...";
	
	// 2) å…¬å…±é€»è¾‘ï¼šçœŸæ­£å»è°ƒç”¨éƒ¨ç½²é’©å­
	async function triggerDeploy() {
	  // âš ï¸ æ³¨æ„ï¼šæŠŠä¸‹é¢ URL æ¢æˆä½ è‡ªå·±çš„ Webhook
	  const url =
	    "https://api.cloudflare.com/...";
	
	  try {
	    const res = await fetch(url, { method: "POST" });
	    console.log("âœ… Deploy Hook å·²è§¦å‘ï¼ŒçŠ¶æ€ç :", res.status);
	    return res.status;
	  } catch (err) {
	    console.error("âŒ Deploy Hook è§¦å‘å¤±è´¥:", err);
	    throw err;
	  }
	}
	
	export default {
	  // ------------------------------------------------------------
	  // å®šæ—¶è§¦å‘ï¼šç”± Cron Trigger è°ƒç”¨
	  // ------------------------------------------------------------
	  async scheduled(event, env, ctx) {
	    // è®© Worker åœ¨åå°å¼‚æ­¥æ‰§è¡Œï¼Œé˜²æ­¢è¶…æ—¶
	    ctx.waitUntil(triggerDeploy());
	  },
	
	  // ------------------------------------------------------------
	  // æ‰‹åŠ¨è§¦å‘ï¼šé€šè¿‡ HTTP è®¿é—® Worker åœ°å€
	  // ä¾‹å¦‚ï¼šGET https://<worker-domain>/?key=SECRET_KEY
	  // ------------------------------------------------------------
	  async fetch(request, env, ctx) {
	    const { searchParams } = new URL(request.url);
	
	    // 1. æ ¡éªŒå¯†é’¥
	    if (searchParams.get("key") !== SECRET_KEY) {
	      return new Response("âŒ æœªæˆæƒï¼šå¯†é’¥ä¸æ­£ç¡®æˆ–ç¼ºå¤±\n", { status: 403 });
	    }
	
	    // 2. è§¦å‘éƒ¨ç½²é’©å­
	    try {
	      const status = await triggerDeploy();
	      return new Response(
	        `ğŸš€ æ‰‹åŠ¨è§¦å‘æˆåŠŸï¼Deploy Hook è¿”å›çŠ¶æ€ï¼š${status}\n`,
	        { status: 200 }
	      );
	    } catch (err) {
	      return new Response(
	        `âš ï¸ æ‰‹åŠ¨è§¦å‘å¤±è´¥ï¼š${err.message || err}\n`,
	        { status: 500 }
	      );
	    }
	  },
	};
	```

5. éƒ¨ç½²ä¸Šè¿°ä»£ç åï¼Œåœ¨ Works é¡¹ç›®çš„è®¾ç½®é¡µé¢æ‰¾åˆ°â€œè§¦å‘äº‹ä»¶â€ï¼Œæ·»åŠ ä¸€ä¸ªâ€œCron è§¦å‘å™¨â€
6. æ·»åŠ ä¸€ä¸ª Cron è¡¨è¾¾å¼ï¼š`0 22 * * *`ï¼Œå³ä¸ºåŒ—äº¬æ—¶é—´æ¯å¤©æ—©ä¸Š 6 ç‚¹è‡ªåŠ¨éƒ¨ç½²
7. Cron è¡¨è¾¾å¼è§„åˆ™å‚è§ [Cloudflare æ–‡æ¡£](https://developers.cloudflare.com/workers/configuration/cron-triggers/#supported-cron-expressions)ï¼Œæ³¨æ„ UTC æ—¶é—´å’ŒåŒ—äº¬æ—¶é—´çš„è½¬æ¢
8. ä½ ä¹Ÿå¯ä»¥é€šè¿‡ Works é¡¹ç›®çš„é“¾æ¥ + è‡ªå®šä¹‰çš„ KEY æ¥å®ç°æ‰‹åŠ¨è§¦å‘ï¼ˆä¸€èˆ¬è°ƒè¯•çš„æ—¶å€™ç”¨çš„ä¸Šï¼‰

### åœ¨ Obsidian ä¸­å‘å¸ƒå’Œæ›´æ–°å†…å®¹

1. åœ¨æƒ³è¦å‘å¸ƒçš„ç¬”è®° YAML åŒºåŸŸä¸­æ·»åŠ  `dg-publish: true`
2. åœ¨æƒ³è¦ä½œä¸ºé¦–é¡µçš„ç¬”è®° YAML åŒºåŸŸä¸­æ·»åŠ  `dg-home: true`ï¼ˆåªèƒ½æœ‰ä¸€ç¯‡ï¼‰
3. æ‰“å¼€ Digital Garden æ’ä»¶çš„å‘å¸ƒä¸­å¿ƒï¼šä½¿ç”¨ `Ctrl+P` æ‰“å¼€ `Digital Gardenï¼šOpen Publication Center`ï¼Œå‹¾é€‰ç¬”è®°å¹¶å‘å¸ƒ
4. ç­‰å¾… Github å’Œ Cloudflare å®Œæˆè‡ªåŠ¨éƒ¨ç½²ï¼ˆæ ¹æ®ç¬”è®°æ•°é‡è€Œå®šï¼Œä¸€èˆ¬ 1~2 åˆ†é’Ÿå†…ï¼‰
5. å³å¯åœ¨åˆšè·å–é“¾æ¥åœ°å€è®¿é—®åˆ°æœ€æ–°çš„å†…å®¹

### å‚è€ƒæ–‡æ¡£

- [Hi , Obsidian Digital Garden](https://immmmm.com/hi-obsidian-digital-garden/)
- [Fine grained access token](https://dg-docs.ole.dev/advanced/fine-grained-access-token/)

## äºŒã€é«˜çº§è¿›é˜¶

### ç»‘å®šåŸŸåæ–¹æ³•

1. æ‰“å¼€ [Cloudflare](https://www.cloudflare.com/zh-cn/)ï¼Œåœ¨å‰é¢åˆ›å»ºçš„ Pages é¡¹ç›®é‡Œæ‰¾åˆ°â€œè‡ªå®šä¹‰åŸŸâ€ï¼Œè¾“å…¥åŸŸååæŒ‰ç…§æµç¨‹æŒ‡å¼•æ“ä½œå³å¯
2. æ‰“å¼€è‡ªå·±åŸŸåè§£æå•†ç½‘ç«™ï¼ˆæˆ‘ä½¿ç”¨ [è…¾è®¯äº‘](https://cloud.tencent.com/)ï¼‰ï¼š
	- è‹¥å‰é¢è®¾ç½®çš„æ˜¯é¡¶çº§åŸŸåï¼Œéœ€è¦è¿ç§» DNS åˆ° Cloudflare
	- è‹¥å‰é¢è®¾ç½®çš„æ˜¯äºŒçº§åŸŸåï¼Œåªéœ€è¦è®¾ç½® CNAME å³å¯

### è‡ªå®šä¹‰ç»„ä»¶æ–¹æ³•

- ä»…ç®€è¦æè¿°ï¼Œå…·ä½“è¯·æŸ¥é˜… [å®˜æ–¹æ–‡æ¡£](https://dg-docs.ole.dev/advanced/adding-custom-components/) å¯¹æ­¤çš„è¯´æ˜
- å¯åœ¨è‡ªå·±åˆ›å»ºçš„ Github é¡¹ç›®ä»“åº“ä¸­ï¼Œåœ¨ `src/site/_includes/components/` è·¯å¾„ä¸‹åˆ›å»º `user` ç›®å½•ï¼Œä½¿ç”¨ `user/<å‘½åç©ºé—´>/<æ’æ§½>/<ä»£ç æ–‡ä»¶>.njk` æ·»åŠ  `njk` æ ¼å¼çš„æ–‡ä»¶
- å…¶ä¸­ `<å‘½åç©ºé—´>` å’Œ `<æ’æ§½>` çš„æ ¼å¼å¦‚ä¸‹
	- é¡µé¢
		- å‘½åç©ºé—´
			- `common` åŒæ—¶æ·»åŠ åˆ°é¦–é¡µå’Œç¬”è®°é¡µé¢ä¸Š
			- `index` ä»…æ·»åŠ åˆ°é¦–é¡µä¸Š
			- `notes` ä»…æ·»åŠ åˆ°ç¬”è®°é¡µä¸Š
		- æ’æ§½
			- `head` æ·»åŠ åˆ° HTML çš„ `<head>` æ ‡ç­¾å†…
			- `header` æ·»åŠ åˆ° HTML çš„ `<heeader>` æ ‡ç­¾å†…ï¼Œå¦‚æœå¯ç”¨äº† `tags` å’Œ `inline title` é‚£ä¹ˆåœ¨ä»–ä»¬ä¹‹å
			- `beforeContent` æ·»åŠ é¡µé¢å†…å®¹ä¹‹å‰
			- `afterContent` æ·»åŠ åˆ°é¡µé¢å†…å®¹ä¹‹å
			- `footer` æ·»åŠ åˆ°é¡µé¢é¡µè„šä¹‹ä¸­
	- æ–‡ä»¶æ ‘
		- å‘½åç©ºé—´
			- `filetree`
		- æ’æ§½
			- `beforeTitle` æ ‡é¢˜ä¹‹å‰
			- `afterTitle` æ ‡é¢˜ä¹‹å
	- ä¾§è¾¹æ 
		- å‘½åç©ºé—´
			- `Sidebar`
		- æ’æ§½
			- `top` é¡¶éƒ¨
			- `bottom` åº•éƒ¨
- ç¤ºä¾‹ï¼šä¸€ä¸ª `<ç»„ä»¶åç§°>.njk` ç»„ä»¶çš„å®Œæ•´åœ°å€ä¸ºï¼ˆå‡è®¾æ”¾åœ¨å…¨éƒ¨é¡µé¢çš„é¡µé¢é¡µè„šä¹‹ä¸­ï¼‰ï¼š`src/site/_includes/components/user/common/footer/<ç»„ä»¶åç§°>.njk`

### è‡ªå®šä¹‰æ ·å¼æ–¹æ³•

- ä»…ç®€è¦æè¿°ï¼Œå…·ä½“è¯·æŸ¥é˜…Â [å®˜æ–¹æ–‡æ¡£](https://dg-docs.ole.dev/advanced/css-customization/)Â å¯¹æ­¤çš„è¯´æ˜
- å¯åœ¨è‡ªå·±åˆ›å»ºçš„ Github é¡¹ç›®ä»“åº“ä¸­ï¼Œåœ¨ `src/site/style/` è·¯å¾„ä¸‹åˆ›å»º `user` ç›®å½•ï¼Œä½¿ç”¨ `user/<ä»£ç æ–‡ä»¶>.css/scss` æ·»åŠ  `css/scss` æ ¼å¼çš„æ–‡ä»¶
- ç¤ºä¾‹ï¼šä¸€ä¸ª `<æ ·å¼åç§°>.css` æ ·å¼çš„å®Œæ•´åœ°å€ä¸ºï¼š`src/site/style/user/<æ ·å¼åç§°>.css`

### æ·»åŠ ç»Ÿè®¡ä»£ç 

TODO

### æ·»åŠ è¯„è®ºä»£ç 

TODO

## ä¸‰ã€è‡ªå®šä¹‰ä»£ç 

> è¿™ä¸ªç« èŠ‚é‡Œåˆ—å‡ºçš„ï¼Œæ˜¯æˆ‘è‡ªå·±ä½¿ç”¨çš„ [[@æ•°å­—èŠ±å›­/0 å…³äºæœ¬ç«™/å»ºç«™æŒ‡å—#è‡ªå®šä¹‰ç»„ä»¶æ–¹æ³•\|è‡ªå®šä¹‰ç»„ä»¶]] å’Œ [[@æ•°å­—èŠ±å›­/0 å…³äºæœ¬ç«™/å»ºç«™æŒ‡å—#è‡ªå®šä¹‰æ ·å¼æ–¹æ³•\|è‡ªå®šä¹‰æ ·å¼]]ã€‚å¯è‡ªè¡Œé€‰æ‹©æ˜¯å¦ä½¿ç”¨ã€‚

TODO